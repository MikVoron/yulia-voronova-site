function updateActiveLink(){const e=document.querySelectorAll("section[id]"),t=document.querySelectorAll(".nav a:not(.nav-dropdown-toggle):not(.nav-dropdown-menu a), .footer-nav a");let n="";e.forEach(e=>{const t=e.offsetTop-150,o=e.offsetHeight;window.scrollY>=t&&window.scrollY<t+o&&(n=e.getAttribute("id"))});var o="/"===window.location.pathname||"/index.html"===window.location.pathname||window.location.pathname.endsWith("/index.html");t.forEach(e=>{var t=e.getAttribute("href");if(t.startsWith("#")||t.startsWith("/#")){if(t.startsWith("/#")){if(!o)return;return e.classList.remove("active"),void(n&&t==="/#"+n&&e.classList.add("active"))}t.startsWith("#")&&t.length>1&&(e.classList.remove("active"),n&&t==="#"+n&&e.classList.add("active"))}})}document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".burger-menu"),t=document.querySelector(".nav"),n=document.querySelector(".nav-close"),o=document.body;if(e&&t){const s=document.createElement("div");s.className="nav-overlay",document.body.appendChild(s);const a=()=>{e.classList.remove("active"),t.classList.remove("active"),s.classList.remove("active"),o.style.overflow=""};e.addEventListener("click",()=>{e.classList.toggle("active"),t.classList.toggle("active"),s.classList.toggle("active"),o.style.overflow=t.classList.contains("active")?"hidden":""}),n&&n.addEventListener("click",a),s.addEventListener("click",a),t.querySelectorAll("a").forEach(e=>{e.addEventListener("click",a)})}const s=document.getElementById("chatLauncher"),a=document.getElementById("chatLauncherBtn"),c=document.getElementById("tawkOpenBtn");s&&a&&(a.addEventListener("click",e=>{e.stopPropagation();const t=s.classList.toggle("open");a.setAttribute("aria-expanded",t),document.getElementById("chatOptions").setAttribute("aria-hidden",!t)}),document.addEventListener("click",e=>{s.contains(e.target)||(s.classList.remove("open"),a.setAttribute("aria-expanded","false"),document.getElementById("chatOptions").setAttribute("aria-hidden","true"))}),c&&c.addEventListener("click",()=>{s.classList.remove("open"),a.setAttribute("aria-expanded","false");const e=document.getElementById("chatBadge");e&&e.classList.remove("visible");const t=document.getElementById("tawkBadge");t&&t.classList.remove("visible"),"undefined"!=typeof Tawk_API&&"function"==typeof Tawk_API.maximize&&Tawk_API.maximize()}));const i=document.querySelector(".nav-dropdown-toggle"),r=document.querySelector(".nav-dropdown");i&&r&&(i.addEventListener("click",e=>{e.stopPropagation();const t=r.classList.toggle("open");i.setAttribute("aria-expanded",t)}),document.addEventListener("click",()=>{r.classList.remove("open"),i.setAttribute("aria-expanded","false")}),r.querySelectorAll(".nav-dropdown-menu a").forEach(e=>{e.addEventListener("click",()=>{r.classList.remove("open"),i.setAttribute("aria-expanded","false")})}))}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=document.querySelector(this.getAttribute("href"));t&&t.scrollIntoView({behavior:"smooth",block:"start"})})}),document.addEventListener("DOMContentLoaded",()=>{if(window.innerWidth>768){const e=document.querySelectorAll(".tariffs-grid .tariff-card-collapsible");e.length>0&&e.forEach(t=>{t.addEventListener("click",n=>{n.target.closest("a, button")||(e.forEach(e=>e.classList.remove("popular")),t.classList.add("popular"))})})}}),document.addEventListener("DOMContentLoaded",()=>{if(window.innerWidth<=768){const e=document.querySelector(".tariffs-grid"),t=document.querySelector(".tariffs-arrow-left"),n=document.querySelector(".tariffs-arrow-right"),o=document.querySelectorAll(".tariff-card-collapsible"),s=document.querySelectorAll(".tariff-dot");if(e&&o.length>0){let a=1;const c=e=>{e<0&&(e=0),e>=o.length&&(e=o.length-1),a=e,"function"==typeof window.closeAllTariffCards&&window.closeAllTariffCards(),o.forEach((e,t)=>{e.classList.remove("active","stack-back-1","stack-back-2"),t===a?e.classList.add("active"):t===a-1||t===a+1?e.classList.add("stack-back-1"):e.classList.add("stack-back-2")}),s.forEach((e,t)=>{e.classList.toggle("active",t===a)}),i()},i=()=>{t&&t.classList.toggle("disabled",a<=0),n&&n.classList.toggle("disabled",a>=o.length-1)};s.forEach((e,t)=>{e.addEventListener("click",()=>{c(t)})}),c(a),t&&t.addEventListener("click",()=>{a>0&&c(a-1)}),n&&n.addEventListener("click",()=>{a<o.length-1&&c(a+1)});const r=document.querySelector(".tariffs");if(r&&"IntersectionObserver"in window){new IntersectionObserver(e=>{e.forEach(e=>{r.classList.toggle("arrows-visible",e.isIntersecting)})},{threshold:.3}).observe(e)}}}}),document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".diplomas-grid"),t=document.querySelector(".diplomas-arrow-left"),n=document.querySelector(".diplomas-arrow-right");if(e&&t&&n){const o=e.querySelectorAll(".diploma-card");let s=0;const a=t=>{t<0&&(t=0),t>=o.length&&(t=o.length-1),s=t;const n=o[t],a=n.offsetLeft,i=n.offsetWidth,r=a-(e.offsetWidth-i)/2;o.forEach((e,n)=>{n===t?e.classList.add("active"):e.classList.remove("active")}),e.scrollTo({left:r,behavior:"smooth"}),c(t)},c=e=>{t.classList.toggle("disabled",0===e),n.classList.toggle("disabled",e===o.length-1)};let i;o.length>1&&(s=1,o[1].classList.add("active"),c(1),setTimeout(()=>{a(1)},100)),t.addEventListener("click",()=>{t.classList.contains("disabled")||a(s-1)}),n.addEventListener("click",()=>{n.classList.contains("disabled")||a(s+1)}),e.addEventListener("scroll",()=>{clearTimeout(i),i=setTimeout(()=>{const t=e.offsetWidth,n=e.scrollLeft+t/2;let a=0,i=1/0;o.forEach((e,t)=>{const o=e.offsetLeft+e.offsetWidth/2,s=Math.abs(n-o);s<i&&(i=s,a=t)}),a!==s&&(s=a,o.forEach((e,t)=>{e.classList.toggle("active",t===s)}),c(s))},100)})}}),document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelectorAll(".first-meeting-v4 .step-item");if(e.length>0&&"IntersectionObserver"in window){const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("animate-visible"),t.unobserve(e.target))})},{threshold:.2,rootMargin:"0px 0px -50px 0px"});e.forEach(e=>{t.observe(e)})}}),document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelectorAll(".services-range, .faq, .telegram-subscribe");if(e.length>0&&"IntersectionObserver"in window){const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("animate-visible"),t.unobserve(e.target))})},{threshold:.15,rootMargin:"0px 0px -50px 0px"});e.forEach(e=>{t.observe(e)})}}),document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelectorAll(".about-help-section, .about-youtube-section, .diplomas");if(e.length>0&&"IntersectionObserver"in window){const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("animate-visible"),t.unobserve(e.target))})},{threshold:.15,rootMargin:"0px 0px -50px 0px"});e.forEach(e=>{t.observe(e)})}}),window.addEventListener("scroll",updateActiveLink),document.addEventListener("DOMContentLoaded",updateActiveLink);let currentTestimonial=0;const testimonials=document.querySelectorAll(".testimonial-card"),prevBtn=document.querySelector(".nav-btn.prev"),nextBtn=document.querySelector(".nav-btn.next");function updateTestimonials(){console.log("Current testimonial:",currentTestimonial)}prevBtn&&nextBtn&&(prevBtn.addEventListener("click",()=>{currentTestimonial=(currentTestimonial-1+testimonials.length)%testimonials.length,updateTestimonials()}),nextBtn.addEventListener("click",()=>{currentTestimonial=(currentTestimonial+1)%testimonials.length,updateTestimonials()}));const newsletterForm=document.querySelector(".newsletter-form");newsletterForm&&newsletterForm.addEventListener("submit",e=>{e.preventDefault();new FormData(newsletterForm);alert("Thank you for subscribing!"),newsletterForm.reset()}),document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelectorAll(".grid-item");e.forEach(e=>{e.classList.add("hidden")});const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.contains("grid-item")?(e.target.classList.add("animate"),setTimeout(()=>{t.unobserve(e.target)},1e3)):(e.target.style.opacity="1",e.target.style.transform="translateY(0)"))})},{threshold:.15,rootMargin:"0px 0px -50px 0px"});e.forEach(e=>{t.observe(e)}),("ontouchstart"in window||navigator.maxTouchPoints>0)&&(e.forEach(t=>{t.addEventListener("click",function(t){t.target.closest("a")||(t.stopPropagation(),this.classList.contains("tapped")?this.classList.remove("tapped"):(e.forEach(e=>e.classList.remove("tapped")),this.classList.add("tapped")))})}),document.addEventListener("click",function(t){t.target.closest(".grid-item")||e.forEach(e=>e.classList.remove("tapped"))})),document.querySelectorAll(".testimonial-card, .booking-info").forEach(e=>{e.style.opacity="0",e.style.transform="translateY(20px)",e.style.transition="opacity 0.6s ease, transform 0.6s ease",t.observe(e)});const n=document.querySelector(".tg-chat-section");n&&(n.classList.add("animate-visible"),window.addEventListener("load",()=>{setTimeout(()=>{const e=n.querySelectorAll(".tg-msg");e.forEach(e=>e.classList.add("tg-msg-ready"));const t=new IntersectionObserver(n=>{n.forEach(n=>{if(n.isIntersecting){const o=n.target,s=Array.from(e).indexOf(o);setTimeout(()=>o.classList.add("tg-msg-visible"),150*s),t.unobserve(o)}})},{threshold:.1});e.forEach(e=>t.observe(e))},2e3)}))});const timeSlots=document.querySelectorAll(".time-slot");timeSlots.forEach(e=>{e.addEventListener("click",()=>{timeSlots.forEach(e=>e.classList.remove("selected")),e.classList.add("selected")})});let lastScroll=0;const header=document.querySelector(".header");window.addEventListener("scroll",()=>{const e=window.pageYOffset;header.style.transform=e>lastScroll&&e>100?"translateY(-100%)":"translateY(0)",lastScroll=e}),document.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll(".tariff-card-collapsible"),t=document.querySelector(".tariffs-grid");console.log("Found cards:",e.length),e.forEach((e,t)=>{e.setAttribute("data-card-id",t),e.classList.remove("is-open");const n=e.querySelector(".tariff-details");n&&n.classList.remove("is-visible")});let n=null;function o(){document.querySelectorAll(".tariff-card-collapsible").forEach(e=>{const t=e.querySelector(".tariff-details"),n=e.querySelector(".expand-indicator-line"),o=n?n.querySelector(".line-text"):null;e.classList.remove("is-open"),t&&t.classList.remove("is-visible"),n&&n.classList.remove("expanded"),o&&(o.textContent="Подробнее")}),t&&t.classList.remove("has-open-card"),n=null}window.closeAllTariffCards=o,e.forEach(e=>{e.addEventListener("click",function(e){e.target.closest(".btn-tariff-fixed")||function(e){if(!e)return;const s=e.getAttribute("data-card-id"),a=e.querySelector(".tariff-details"),c=e.querySelector(".expand-indicator-line"),i=c?c.querySelector(".line-text"):null,r=n===s;if(o(),r&&window.innerWidth<=768){const e=document.querySelector(".tariffs")||document.getElementById("tariffs");e&&setTimeout(()=>{e.scrollIntoView({behavior:"smooth",block:"center"})},100)}r||(e.classList.add("is-open"),a&&a.classList.add("is-visible"),c&&c.classList.add("expanded"),i&&(i.textContent="Свернуть"),n=s,t&&t.classList.add("has-open-card"),window.innerWidth<=768&&setTimeout(()=>{e.scrollIntoView({behavior:"smooth",block:"start"})},100))}(this)})})}),document.querySelectorAll(".tab-btn").forEach(e=>{e.addEventListener("click",function(){const e=this.getAttribute("data-tab");document.querySelectorAll(".tab-btn").forEach(e=>e.classList.remove("active")),document.querySelectorAll(".tab-panel").forEach(e=>e.classList.remove("active")),this.classList.add("active"),document.getElementById(e).classList.add("active")})}),document.querySelectorAll(".filter-btn").forEach(e=>{e.addEventListener("click",function(){const e=this.getAttribute("data-filter");document.querySelectorAll(".filter-btn").forEach(e=>e.classList.remove("active")),this.classList.add("active"),document.querySelectorAll(".filter-card").forEach(t=>{const n=t.getAttribute("data-category");"all"===e||n===e?t.classList.remove("hidden"):t.classList.add("hidden")})})}),document.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll(".faq-item");e.forEach(t=>{t.querySelector(".faq-question").addEventListener("click",function(){const n=t.classList.contains("active");e.forEach(e=>{e.classList.remove("active")}),n||t.classList.add("active")})})}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("diploma-modal"),t=document.getElementById("diploma-modal-image"),n=document.querySelector(".diploma-modal-close"),o=document.querySelector(".diploma-modal-prev"),s=document.querySelector(".diploma-modal-next"),a=document.querySelectorAll(".diploma-card");if(!(e&&t&&n&&o&&s&&0!==a.length))return;let c=0;const i=Array.from(a).map(e=>e.getAttribute("data-diploma"));function r(){e.classList.remove("active"),document.body.style.overflow=""}function d(){c=(c-1+i.length)%i.length,t.src=i[c]}function l(){c=(c+1)%i.length,t.src=i[c]}a.forEach((n,o)=>{n.addEventListener("click",function(){c=o,e.classList.add("active"),t.src=i[c],document.body.style.overflow="hidden"})}),n.addEventListener("click",r),e.addEventListener("click",function(t){t.target===e&&r()}),o.addEventListener("click",d),s.addEventListener("click",l),document.addEventListener("keydown",function(t){e.classList.contains("active")&&("Escape"===t.key?r():"ArrowLeft"===t.key?d():"ArrowRight"===t.key&&l())})}),document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".testimonials-carousel-track"),t=document.querySelector(".carousel-btn-prev"),n=document.querySelector(".carousel-btn-next"),o=document.querySelector(".carousel-dots");if(!e)return;const s=e.querySelectorAll(".social-testimonial-card"),a=s.length;let c=0,i=r();function r(){return window.innerWidth<=480?1:window.innerWidth<=768?2:3}function d(){if(!o)return;o.innerHTML="";const e=Math.ceil(a/r());for(let t=0;t<e;t++){const e=document.createElement("button");e.classList.add("carousel-dot"),0===t&&e.classList.add("active"),e.setAttribute("aria-label",`Перейти к слайду ${t+1}`),e.addEventListener("click",()=>u(t)),o.appendChild(e)}}function l(){const r=s[0].offsetWidth,d=c*(r+30)*i;if(e.style.transform=`translateX(-${d}px)`,function(){if(!o)return;o.querySelectorAll(".carousel-dot").forEach((e,t)=>{e.classList.toggle("active",t===c)})}(),t&&(t.disabled=0===c),n){const e=Math.ceil(a/i)-1;n.disabled=c>=e}}function u(e){const t=Math.ceil(a/i)-1;c=Math.max(0,Math.min(e,t)),l()}function m(){const e=Math.ceil(a/i)-1;c<e&&(c++,l())}function f(){c>0&&(c--,l())}t&&t.addEventListener("click",f),n&&n.addEventListener("click",m);let v,L=0,h=0;e.addEventListener("touchstart",e=>{L=e.changedTouches[0].screenX},{passive:!0}),e.addEventListener("touchend",e=>{h=e.changedTouches[0].screenX,function(){const e=50,t=L-h;Math.abs(t)>e&&(t>0?m():f())}()},{passive:!0}),window.addEventListener("resize",()=>{clearTimeout(v),v=setTimeout(()=>{const e=r();e!==i&&(i=e,c=0,d()),l()},150)}),d(),l()}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("testimonial-modal"),t=document.getElementById("testimonial-modal-image"),n=document.querySelector(".testimonial-modal-close"),o=document.querySelector(".testimonial-modal-prev"),s=document.querySelector(".testimonial-modal-next"),a=document.querySelectorAll(".social-testimonial-card"),c=document.getElementById("testimonial-info-name"),i=document.getElementById("testimonial-info-age"),r=document.getElementById("testimonial-info-request");if(!e||!t)return;let d=0;const l=Array.from(a).map(e=>({image:e.getAttribute("data-testimonial"),name:e.getAttribute("data-name")||"",age:e.getAttribute("data-age")||"",request:e.getAttribute("data-request")||""}));function u(){const e=l[d];e&&(t.src=e.image,c&&(c.textContent=e.name),i&&(i.textContent=e.age),r&&(r.textContent=e.request))}function m(){d=(d-1+l.length)%l.length,u()}function f(){d=(d+1)%l.length,u()}function v(){e.classList.remove("active"),document.body.style.overflow=""}a.forEach((t,n)=>{t.addEventListener("click",function(){d=n,u(),e.classList.add("active"),document.body.style.overflow="hidden"})}),o&&o.addEventListener("click",function(e){e.stopPropagation(),m()}),s&&s.addEventListener("click",function(e){e.stopPropagation(),f()}),n&&n.addEventListener("click",function(e){e.stopPropagation(),v()}),e.addEventListener("click",function(n){n.target!==e&&n.target!==t||v()}),document.addEventListener("keydown",function(t){e.classList.contains("active")&&("Escape"===t.key?v():"ArrowLeft"===t.key?m():"ArrowRight"===t.key&&f())})}),document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".contact-email-form");if(!e)return;const t=e.querySelector('input[name="privacy"]'),n=e.querySelector(".privacy-tooltip");t&&n&&(e.addEventListener("submit",function(e){t.checked||(e.preventDefault(),n.classList.add("show"),setTimeout(()=>{n.classList.remove("show")},3e3))}),t.addEventListener("change",function(){this.checked&&n.classList.remove("show")}))}),document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("contact-form"),t=document.getElementById("success-modal"),n=document.querySelector(".success-modal-close");e&&t&&(e.addEventListener("submit",async n=>{n.preventDefault();const o=e.querySelector('input[name="privacy"]'),s=e.querySelector(".privacy-checkbox");if(o&&!o.checked)return s.classList.add("shake"),void setTimeout(()=>{s.classList.remove("shake")},600);const a=new FormData(e),c=e.querySelector('button[type="submit"]'),i=c.textContent;c.disabled=!0,c.textContent="Отправка...";try{(await fetch("https://api.web3forms.com/submit",{method:"POST",body:a})).ok?(t.classList.add("active"),e.reset(),setTimeout(()=>{t.classList.remove("active")},5e3)):alert("Произошла ошибка. Попробуйте ещё раз.")}catch(e){alert("Произошла ошибка. Попробуйте ещё раз.")}c.disabled=!1,c.textContent=i}),n&&n.addEventListener("click",()=>{t.classList.remove("active")}),t.addEventListener("click",e=>{e.target===t&&t.classList.remove("active")}))});